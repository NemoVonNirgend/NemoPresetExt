--- auto-lorebook.js.orig
+++ auto-lorebook.js
@@ -202,11 +202,25 @@
         try {
             console.log(`[NemoLore Auto-Lorebook] Creating lorebook for chat: ${chatId}`);

-            // Get current character info
-            const character = characters[this_chid];
+            // Get current character info - try both sources
+            let character = characters ? characters[this_chid] : null;
+
+            // Fallback to window.characters if module import failed
+            if (!character && typeof window !== 'undefined' && window.characters && typeof window.this_chid !== 'undefined') {
+                character = window.characters[window.this_chid];
+                console.log('[NemoLore Auto-Lorebook] Using window.characters as fallback');
+            }
+
             if (!character) {
                 console.warn('[NemoLore Auto-Lorebook] No active character found');
+                const { NotificationManager } = await import('./utils/notification-manager.js');
+                const notifManager = new NotificationManager();
+                notifManager.showMessage('‚ùå Failed to create lorebook: No active character found.', 5000);
                 return;
             }

             // Sanitize character name for use in lorebook name
