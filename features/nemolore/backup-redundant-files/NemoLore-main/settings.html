<div class="nemolore_settings" id="nemo-ext-nemolore" data-extension-name="NemoLore">
    <!-- Modern drawer interface (default) -->
    <div class="inline-drawer nemolore-drawer-interface">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>NemoLore</b>
            <div class="nemolore-compatibility-notice" style="display: none; margin-left: 10px;">
                <small><em>(Using fallback layout)</em></small>
            </div>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down interactable" tabindex="0"></div>
        </div>
        <div class="inline-drawer-content">
            
            <!-- NemoLore Settings Sub-drawer -->
            <div class="inline-drawer">
                <div class="inline-drawer-toggle inline-drawer-header">
                    <b>NemoLore Settings</b>
                    <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down interactable" tabindex="0"></div>
                </div>
                <div class="inline-drawer-content">
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_enabled">
                            <input id="nemolore_enabled" type="checkbox">
                            Enable NemoLore
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_highlight">
                            <input id="nemolore_highlight" type="checkbox">
                            Highlight Nouns
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_auto_lorebook">
                            <input id="nemolore_auto_lorebook" type="checkbox">
                            Create Lorebook on Chat Start
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_auto_create_lorebook">
                            <input id="nemolore_auto_create_lorebook" type="checkbox">
                            Auto-Create Independent Lorebooks (NemoLore)
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_auto_mode">
                            <input id="nemolore_auto_mode" type="checkbox">
                            Auto Mode (periodic updates)
                        </label>
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_update_interval">Update Interval (messages):</label>
                        <input id="nemolore_update_interval" type="number" class="text_pole">
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_notification_timeout">Notification Timeout (ms):</label>
                        <input id="nemolore_notification_timeout" type="number" class="text_pole">
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_force_compatibility_mode">
                            <input id="nemolore_force_compatibility_mode" type="checkbox">
                            Force Compatibility Mode (use fallback UI)
                        </label>
                    </div>
                </div>
            </div>

            <!-- Message Summarization Sub-drawer -->
            <div class="inline-drawer">
                <div class="inline-drawer-toggle inline-drawer-header">
                    <b>Message Summarization</b>
                    <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down interactable" tabindex="0"></div>
                </div>
                <div class="inline-drawer-content">
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_enable_summarization">
                            <input id="nemolore_enable_summarization" type="checkbox">
                            Enable Summarization
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_auto_summarize">
                            <input id="nemolore_auto_summarize" type="checkbox">
                            Enable Automatic Chat Management Detection
                        </label>
                        <small style="display: block; color: #666; margin-top: 5px;">
                            When enabled, NemoLore will automatically detect unsummarized chats and prompt you for permission to manage them.
                        </small>
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_connection_profile">Connection Profile:</label>
                        <select id="nemolore_connection_profile" class="text_pole">
                            <option value="">Same as Current</option>
                        </select>
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_completion_preset">Completion Preset:</label>
                        <select id="nemolore_completion_preset" class="text_pole">
                            <option value="">Same as Current</option>
                        </select>
                    </div>
                    
                    <!-- Async API Settings -->
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_enable_async_api">
                            <input id="nemolore_enable_async_api" type="checkbox">
                            Enable Independent Async API (Optional but Recommended)
                        </label>
                    </div>
                    <div id="nemolore_async_api_container" class="nemolore-async-api-settings" style="display: none; margin-left: 20px; padding: 10px; border-left: 3px solid #4a90e2; background: #f8f9fa;">
                        <div class="flex-container">
                            <label for="nemolore_async_api_provider">API Provider:</label>
                            <select id="nemolore_async_api_provider" class="text_pole">
                                <option value="">Select Provider</option>
                                <option value="openai">OpenAI</option>
                                <option value="gemini">Google Gemini</option>
                                <option value="claude">Anthropic Claude</option>
                                <option value="openrouter">OpenRouter</option>
                            </select>
                        </div>
                        <div class="flex-container">
                            <label for="nemolore_async_api_key">API Key:</label>
                            <input id="nemolore_async_api_key" type="password" class="text_pole" placeholder="Enter your API key">
                            <small style="display: block; color: #666; margin-top: 5px;">Your API key is stored locally and only used for NemoLore requests.</small>
                        </div>
                        <div class="flex-container">
                            <label for="nemolore_async_api_model">Model:</label>
                            <select id="nemolore_async_api_model" class="text_pole">
                                <option value="">Select model after choosing provider</option>
                            </select>
                            <button id="nemolore_refresh_models" class="menu_button" style="margin-left: 10px; padding: 2px 8px;">Refresh Models</button>
                        </div>
                        <div class="flex-container">
                            <label for="nemolore_async_api_endpoint">Custom Endpoint (Optional):</label>
                            <input id="nemolore_async_api_endpoint" type="text" class="text_pole" placeholder="Leave blank for default">
                        </div>
                        <div class="flex-container">
                            <small style="color: #4a90e2;"><strong>Benefits:</strong> Summaries happen in background while you chat, faster processing, no interruption to your conversation flow.</small>
                        </div>
                        <div class="flex-container">
                            <button id="nemolore_test_async_api" class="menu_button" style="background-color: #28a745; color: white;">ðŸ§ª Test API Connection</button>
                        </div>
                    </div>
                    
                    <div class="flex-container">
                        <label for="nemolore_prefill">Summarization Prefill:</label>
                        <input id="nemolore_prefill" type="text" class="text_pole">
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_summary_threshold">Summary Threshold (tokens):</label>
                        <input id="nemolore_summary_threshold" type="number" class="text_pole">
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_summary_max_length">Summary Max Length (tokens):</label>
                        <input id="nemolore_summary_max_length" type="number" class="text_pole">
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_running_memory_size">Running Memory Size (messages):</label>
                        <input id="nemolore_running_memory_size" type="number" class="text_pole" min="10" max="200">
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_show_summaries">
                            <input id="nemolore_show_summaries" type="checkbox">
                            Show Summaries in Chat
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_hide_messages_threshold">
                            <input id="nemolore_hide_messages_threshold" type="checkbox">
                            Hide Messages When Threshold Reached
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_include_time_location">
                            <input id="nemolore_include_time_location" type="checkbox">
                            Include Time/Location in Summary
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_include_npcs">
                            <input id="nemolore_include_npcs" type="checkbox">
                            Include NPCs in Summary
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_include_events">
                            <input id="nemolore_include_events" type="checkbox">
                            Include Events in Summary
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_include_dialogue">
                            <input id="nemolore_include_dialogue" type="checkbox">
                            Include Dialogue in Summary
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_enable_paired_summarization">
                            <input id="nemolore_enable_paired_summarization" type="checkbox">
                            Enable Paired Message Summarization (0, 1+2, 3+4, etc.)
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_link_summaries_to_ai">
                            <input id="nemolore_link_summaries_to_ai" type="checkbox">
                            Link Summaries Only to AI Messages
                        </label>
                    </div>
                </div>
            </div>

            <!-- Core Memory System Sub-drawer -->
            <div class="inline-drawer">
                <div class="inline-drawer-toggle inline-drawer-header">
                    <b>Core Memory System</b>
                    <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down interactable" tabindex="0"></div>
                </div>
                <div class="inline-drawer-content">
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_enable_core_memories">
                            <input id="nemolore_enable_core_memories" type="checkbox">
                            Enable Core Memory Detection
                        </label>
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_core_memory_start_count">Start Checking After (messages):</label>
                        <input id="nemolore_core_memory_start_count" type="number" class="text_pole" min="1" max="100">
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_core_memory_prompt_lorebook">
                            <input id="nemolore_core_memory_prompt_lorebook" type="checkbox">
                            Auto-Add to Core Memory Lorebook Entry
                        </label>
                    </div>
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_core_memory_replace_message">
                            <input id="nemolore_core_memory_replace_message" type="checkbox">
                            Replace Original Messages When Aging Out
                        </label>
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_core_memory_animation_duration">Animation Duration (ms):</label>
                        <input id="nemolore_core_memory_animation_duration" type="number" class="text_pole" min="500" max="5000" step="100">
                    </div>
                    <div class="flex-container">
                        <small><strong>Core Memories</strong> are automatically detected when the AI identifies significant narrative moments using &lt;CORE_MEMORY&gt; tags. They receive special golden animations and are automatically collected into a single "Core Memories" lorebook entry.</small>
                    </div>
                    <div class="flex-container">
                        <small><strong>How it works:</strong> When the first core memory is detected, a "Core Memories" lorebook entry is created. Each subsequent core memory is automatically appended to this entry as a chronological list.</small>
                    </div>
                    <div class="flex-container">
                        <small><strong>Detection:</strong> The AI will identify moments like character deaths, major revelations, relationship changes, or other pivotal story events.</small>
                    </div>
                </div>
            </div>

            <!-- Vectorization & Semantic Search Sub-drawer -->
            <div class="inline-drawer">
                <div class="inline-drawer-toggle inline-drawer-header">
                    <b>Vectorization & Semantic Search</b>
                    <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down interactable" tabindex="0"></div>
                </div>
                <div class="inline-drawer-content">
                    <div class="flex-container">
                        <label class="checkbox_label" for="nemolore_enable_vectorization">
                            <input id="nemolore_enable_vectorization" type="checkbox">
                            Enable Vectorization
                        </label>
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_vectorization_source">Vectorization Source:</label>
                        <select id="nemolore_vectorization_source" class="text_pole">
                            <option value="openai">OpenAI</option>
                            <option value="google">Google Gemini</option>
                            <option value="cohere">Cohere</option>
                            <option value="transformers">Transformers.js (Local)</option>
                            <option value="ollama">Ollama (Local)</option>
                            <option value="vllm">vLLM</option>
                            <option value="webllm">WebLLM</option>
                        </select>
                    </div>
                    <div class="flex-container" id="nemolore_openai_model_container" style="display: none;">
                        <label for="nemolore_openai_model">OpenAI Model:</label>
                        <select id="nemolore_openai_model" class="text_pole">
                            <option value="text-embedding-ada-002">text-embedding-ada-002</option>
                            <option value="text-embedding-3-small">text-embedding-3-small</option>
                            <option value="text-embedding-3-large">text-embedding-3-large</option>
                        </select>
                    </div>
                    <div class="flex-container" id="nemolore_google_model_container" style="display: none;">
                        <label for="nemolore_google_model">Google Model:</label>
                        <select id="nemolore_google_model" class="text_pole">
                            <option value="text-embedding-004">text-embedding-004</option>
                            <option value="gemini-embedding-001">gemini-embedding-001</option>
                            <option value="embedding-001">embedding-001</option>
                        </select>
                    </div>
                    <div class="flex-container" id="nemolore_cohere_model_container" style="display: none;">
                        <label for="nemolore_cohere_model">Cohere Model:</label>
                        <select id="nemolore_cohere_model" class="text_pole">
                            <option value="embed-v4.0">embed-v4.0</option>
                            <option value="embed-english-v3.0">embed-english-v3.0</option>
                            <option value="embed-multilingual-v3.0">embed-multilingual-v3.0</option>
                            <option value="embed-english-light-v3.0">embed-english-light-v3.0</option>
                        </select>
                    </div>
                    <div class="flex-container" id="nemolore_ollama_model_container" style="display: none;">
                        <label for="nemolore_ollama_model">Ollama Model:</label>
                        <input id="nemolore_ollama_model" type="text" class="text_pole" placeholder="e.g. mxbai-embed-large" />
                    </div>
                    <div class="flex-container" id="nemolore_vllm_model_container" style="display: none;">
                        <label for="nemolore_vllm_model">vLLM Model:</label>
                        <input id="nemolore_vllm_model" type="text" class="text_pole" placeholder="e.g. intfloat/e5-mistral-7b-instruct" />
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_vector_search_limit">Max Relevant Messages:</label>
                        <input id="nemolore_vector_search_limit" type="number" class="text_pole" min="1" max="10">
                    </div>
                    <div class="flex-container">
                        <label for="nemolore_vector_similarity_threshold">Similarity Threshold:</label>
                        <input id="nemolore_vector_similarity_threshold" type="number" class="text_pole" min="0.1" max="1.0" step="0.1">
                    </div>
                    <div class="flex-container">
                        <small><strong>Vectorization</strong> stores excluded messages for semantic search. When enabled, highly relevant past messages can be retrieved and injected into context based on current conversation topics.</small>
                    </div>
                    <div class="flex-container">
                        <small><strong>Google Gemini</strong> (recommended): Use your existing Google AI API key configured in SillyTavern's main settings. Supports text-embedding-004 and other Gemini embedding models.</small>
                    </div>
                    <div class="flex-container">
                        <small><strong>Requirements:</strong> Configure your chosen vectorization source in SillyTavern's main Vector Storage settings first.</small>
                    </div>
                </div>
            </div>

            <!-- Summary Viewer Sub-drawer -->
            <div class="inline-drawer">
                <div class="inline-drawer-toggle inline-drawer-header">
                    <b>Summary Viewer</b>
                    <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down interactable" tabindex="0"></div>
                </div>
                <div class="inline-drawer-content">
                    <div class="flex-container">
                        <button id="nemolore_view_summaries" class="menu_button" style="width: 100%;">
                            View Current Chat Summaries
                        </button>
                    </div>
                    <div class="flex-container">
                        <button id="nemolore_export_summaries" class="menu_button" style="width: 100%;">
                            Export Summaries to JSON
                        </button>
                    </div>
                    <div class="flex-container">
                        <button id="nemolore_system_check" class="menu_button" style="width: 100%; background-color: #4a5568; color: white;">
                            ðŸ”§ Run System Check
                        </button>
                    </div>
                    <div class="flex-container">
                        <small><strong>Summary Viewer</strong> shows all chat summaries in chronological order. Use the {{NemoLore}} macro to inject summaries into prompts.</small>
                    </div>
                    <div class="flex-container">
                        <small><strong>System Check</strong> tests all core NemoLore functions and reports any issues found.</small>
                    </div>
                    <div class="flex-container" id="nemolore_summary_count" style="font-style: italic; color: #888;">
                        No summaries available
                    </div>
                </div>
            </div>
            
        </div> <!-- End main NemoLore drawer content -->
    </div> <!-- End main NemoLore drawer -->
    
    <!-- Fallback interface for compatibility (hidden by default) -->
    <div class="nemolore-fallback-interface" style="display: none;">
        <div class="extension_block">
            <h3>NemoLore</h3>
            <div class="nemolore-compatibility-notice" style="display: block;">
                <small><em>Using fallback settings layout for compatibility with default UI</em></small>
            </div>
        </div>
        
        <details open>
            <summary><strong>NemoLore Settings</strong></summary>
            <div class="nemolore-settings-section">
                <label><input id="nemolore_enabled_fallback" type="checkbox"> Enable NemoLore</label><br>
                <label><input id="nemolore_highlight_fallback" type="checkbox"> Highlight Nouns</label><br>
                <label><input id="nemolore_auto_lorebook_fallback" type="checkbox"> Create Lorebook on Chat Start</label><br>
                <label><input id="nemolore_auto_create_lorebook_fallback" type="checkbox"> Auto-Create Independent Lorebooks (NemoLore)</label><br>
                <label><input id="nemolore_auto_mode_fallback" type="checkbox"> Auto Mode (periodic updates)</label><br>
                <label>Update Interval (messages): <input id="nemolore_update_interval_fallback" type="number" style="width: 80px;"></label><br>
                <label>Notification Timeout (ms): <input id="nemolore_notification_timeout_fallback" type="number" style="width: 100px;"></label>
                <label><input id="nemolore_force_compatibility_mode_fallback" type="checkbox"> Force Compatibility Mode (requires restart)</label>
            </div>
        </details>
        
        <details>
            <summary><strong>Message Summarization</strong></summary>
            <div class="nemolore-settings-section">
                <label><input id="nemolore_enable_summarization_fallback" type="checkbox"> Enable Summarization</label><br>
                <label><input id="nemolore_auto_summarize_fallback" type="checkbox"> Enable Automatic Chat Management Detection</label><br>
                <small style="color: #666;">When enabled, NemoLore will automatically detect unsummarized chats and prompt for permission.</small><br>
                <label>Connection Profile: <select id="nemolore_connection_profile_fallback"><option value="">Same as Current</option></select></label><br>
                <label>Completion Preset: <select id="nemolore_completion_preset_fallback"><option value="">Same as Current</option></select></label><br>
                
                <!-- Async API Settings (Fallback) -->
                <label><input id="nemolore_enable_async_api_fallback" type="checkbox"> Enable Independent Async API (Optional but Recommended)</label><br>
                <div id="nemolore_async_api_container_fallback" style="display: none; margin-left: 20px; padding: 10px; border: 1px solid #ddd; background: #f9f9f9;">
                    <label>API Provider: 
                        <select id="nemolore_async_api_provider_fallback">
                            <option value="">Select Provider</option>
                            <option value="openai">OpenAI</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="claude">Anthropic Claude</option>
                            <option value="openrouter">OpenRouter</option>
                        </select>
                    </label><br>
                    <label>API Key: <input id="nemolore_async_api_key_fallback" type="password" placeholder="Enter your API key" style="width: 250px;"></label><br>
                    <label>Model: 
                        <select id="nemolore_async_api_model_fallback">
                            <option value="">Select model after choosing provider</option>
                        </select>
                        <button id="nemolore_refresh_models_fallback" class="menu_button" style="padding: 2px 8px;">Refresh</button>
                    </label><br>
                    <label>Custom Endpoint: <input id="nemolore_async_api_endpoint_fallback" type="text" placeholder="Leave blank for default" style="width: 250px;"></label><br>
                    <button id="nemolore_test_async_api_fallback" class="menu_button" style="background-color: #28a745; color: white;">ðŸ§ª Test API</button><br>
                    <small style="color: #666;">Benefits: Background processing, no conversation interruption</small>
                </div>
                
                <label>Summarization Prefill: <input id="nemolore_prefill_fallback" type="text" style="width: 200px;"></label><br>
                <label>Summary Threshold (tokens): <input id="nemolore_summary_threshold_fallback" type="number" style="width: 100px;"></label><br>
                <label>Summary Max Length (tokens): <input id="nemolore_summary_max_length_fallback" type="number" style="width: 100px;"></label><br>
                <label>Running Memory Size (messages): <input id="nemolore_running_memory_size_fallback" type="number" style="width: 80px;" min="10" max="200"></label><br>
                <label><input id="nemolore_show_summaries_fallback" type="checkbox"> Show Summaries in Chat</label><br>
                <label><input id="nemolore_hide_messages_threshold_fallback" type="checkbox"> Hide Messages When Threshold Reached</label><br>
                <label><input id="nemolore_include_time_location_fallback" type="checkbox"> Include Time/Location in Summary</label><br>
                <label><input id="nemolore_include_npcs_fallback" type="checkbox"> Include NPCs in Summary</label><br>
                <label><input id="nemolore_include_events_fallback" type="checkbox"> Include Events in Summary</label><br>
                <label><input id="nemolore_include_dialogue_fallback" type="checkbox"> Include Dialogue in Summary</label><br>
                <label><input id="nemolore_enable_paired_summarization_fallback" type="checkbox"> Enable Paired Message Summarization (0, 1+2, 3+4, etc.)</label><br>
                <label><input id="nemolore_link_summaries_to_ai_fallback" type="checkbox"> Link Summaries Only to AI Messages</label>
            </div>
        </details>
        
        <details>
            <summary><strong>Core Memory System</strong></summary>
            <div class="nemolore-settings-section">
                <label><input id="nemolore_enable_core_memories_fallback" type="checkbox"> Enable Core Memory Detection</label><br>
                <label>Start Checking After (messages): <input id="nemolore_core_memory_start_count_fallback" type="number" style="width: 80px;" min="1" max="100"></label><br>
                <label><input id="nemolore_core_memory_prompt_lorebook_fallback" type="checkbox"> Auto-Add to Core Memory Lorebook Entry</label><br>
                <label><input id="nemolore_core_memory_replace_message_fallback" type="checkbox"> Replace Original Messages When Aging Out</label><br>
                <label>Animation Duration (ms): <input id="nemolore_core_memory_animation_duration_fallback" type="number" style="width: 100px;" min="500" max="5000" step="100"></label><br>
                <small><strong>Core Memories</strong> are automatically detected when the AI identifies significant narrative moments using &lt;CORE_MEMORY&gt; tags.</small>
            </div>
        </details>
        
        <details>
            <summary><strong>Vectorization & Semantic Search</strong></summary>
            <div class="nemolore-settings-section">
                <label><input id="nemolore_enable_vectorization_fallback" type="checkbox"> Enable Vectorization</label><br>
                <label>Vectorization Source: 
                    <select id="nemolore_vectorization_source_fallback">
                        <option value="openai">OpenAI</option>
                        <option value="google">Google Gemini</option>
                        <option value="cohere">Cohere</option>
                        <option value="transformers">Transformers.js (Local)</option>
                        <option value="ollama">Ollama (Local)</option>
                        <option value="vllm">vLLM</option>
                        <option value="webllm">WebLLM</option>
                    </select>
                </label><br>
                <div id="nemolore_model_containers_fallback" style="margin: 10px 0;">
                    <label style="display: none;" id="nemolore_openai_model_fallback_container">OpenAI Model: 
                        <select id="nemolore_openai_model_fallback">
                            <option value="text-embedding-ada-002">text-embedding-ada-002</option>
                            <option value="text-embedding-3-small">text-embedding-3-small</option>
                            <option value="text-embedding-3-large">text-embedding-3-large</option>
                        </select>
                    </label><br>
                    <label style="display: none;" id="nemolore_google_model_fallback_container">Google Model: 
                        <select id="nemolore_google_model_fallback">
                            <option value="text-embedding-004">text-embedding-004</option>
                            <option value="gemini-embedding-001">gemini-embedding-001</option>
                            <option value="embedding-001">embedding-001</option>
                        </select>
                    </label><br>
                    <label style="display: none;" id="nemolore_cohere_model_fallback_container">Cohere Model: 
                        <select id="nemolore_cohere_model_fallback">
                            <option value="embed-v4.0">embed-v4.0</option>
                            <option value="embed-english-v3.0">embed-english-v3.0</option>
                            <option value="embed-multilingual-v3.0">embed-multilingual-v3.0</option>
                            <option value="embed-english-light-v3.0">embed-english-light-v3.0</option>
                        </select>
                    </label><br>
                    <label style="display: none;" id="nemolore_ollama_model_fallback_container">Ollama Model: <input id="nemolore_ollama_model_fallback" type="text" placeholder="e.g. mxbai-embed-large" style="width: 200px;"></label><br>
                    <label style="display: none;" id="nemolore_vllm_model_fallback_container">vLLM Model: <input id="nemolore_vllm_model_fallback" type="text" placeholder="e.g. intfloat/e5-mistral-7b-instruct" style="width: 250px;"></label>
                </div>
                <label>Max Relevant Messages: <input id="nemolore_vector_search_limit_fallback" type="number" style="width: 60px;" min="1" max="10"></label><br>
                <label>Similarity Threshold: <input id="nemolore_vector_similarity_threshold_fallback" type="number" style="width: 80px;" min="0.1" max="1.0" step="0.1"></label><br>
                <small><strong>Vectorization</strong> stores excluded messages for semantic search.</small>
            </div>
        </details>
        
        <details>
            <summary><strong>Summary Viewer</strong></summary>
            <div class="nemolore-settings-section">
                <button id="nemolore_view_summaries_fallback" class="menu_button" style="width: 100%;">View Current Chat Summaries</button><br><br>
                <button id="nemolore_export_summaries_fallback" class="menu_button" style="width: 100%;">Export Summaries to JSON</button><br><br>
                <button id="nemolore_system_check_fallback" class="menu_button" style="width: 100%; background-color: #4a5568; color: white;">ðŸ”§ Run System Check</button><br><br>
                <small><strong>Summary Viewer</strong> shows all chat summaries in chronological order. Use the {{NemoLore}} macro to inject summaries into prompts.</small><br>
                <small><strong>System Check</strong> tests all core NemoLore functions and reports any issues found.</small><br>
                <div id="nemolore_summary_count_fallback" style="font-style: italic; color: #888;">No summaries available</div>
            </div>
        </details>
    </div> <!-- End fallback interface -->
</div> <!-- End nemolore_settings -->